{# reviews/templates/reviews/includes/_cafe_card.html #}
{% load static %}

<article class="card cafe-card focus:outline-none" tabindex="0">
  <a href="{% url 'reviews:cafe_detail' cafe.id %}" class="block">
    <div class="card-media">
      {% if cafe.photo1 and cafe.photo1.url %}
        <img src="{{ cafe.photo1.url }}"
             alt="{{ cafe.photo1_title|default:cafe.name }}"
             loading="lazy" decoding="async" fetchpriority="low">
      {% else %}
        <img src="{% static 'img/cafe-placeholder.jpg' %}"
             alt="Foto no disponible — {{ cafe.name }}"
             loading="lazy" decoding="async" fetchpriority="low">
      {% endif %}
    </div>
  </a>

  <div class="card-body">
    <a href="{% url 'reviews:cafe_detail' cafe.id %}" class="block hover:underline">
      <h3 class="card-title">{{ cafe.name }}</h3>

      {# Ubicación sin usar 'city' #}
      {% if cafe.location %}
        <p class="card-sub">{{ cafe.location }}</p>
      {% elif cafe.neighborhood %}
        <p class="card-sub">{{ cafe.neighborhood }}</p>
      {% elif cafe.address %}
        <p class="card-sub">{{ cafe.address }}</p>
      {% endif %}
    </a>

    <div class="card-actions">
      <div class="flex items-center gap-2">
        {% with avg=cafe.average_rating|default:0 %}
          <span class="badge" title="Calificación promedio">
            ☕ {{ avg|floatformat:1 }} / 5
          </span>
        {% endwith %}
        {% with rc=cafe.reviews_count|default:0 %}
          <span class="text-muted text-sm">({{ rc }} reseñas)</span>
        {% endwith %}
      </div>

      <div class="flex items-center gap-2">
        <button type="button"
                class="btn btn-outline btn-sm"
                aria-pressed="{{ cafe.is_favorite|yesno:'true,false' }}"
                onclick="bounceLike(this)">
          <span aria-hidden="true">❤️</span>
          <span class="sr-only">Marcar como favorito</span>
        </button>

        <a href="{% url 'reviews:cafe_detail' cafe.id %}" class="btn btn-primary btn-sm">
          Ver
        </a>
      </div>
    </div>
  </div>
</article>
