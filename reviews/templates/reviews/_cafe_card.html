{# reviews/templates/reviews/_cafe_card.html #}
<div
  role="group"
  aria-labelledby="cafe-{{ cafe.id }}-title"
  class="card recommended-card animate-fade-in-up {% cycle '' 'animate-delay-100' 'animate-delay-200' 'animate-delay-300' %} relative overflow-hidden group flex flex-col h-full"
>
  {# Botón de favoritos (si está autenticado) #}
  {% if user.is_authenticated %}
    <form method="POST" action="{% url 'toggle_favorite' cafe.id %}" class="absolute top-4 right-4 z-10">
      {% csrf_token %}
      <button
        type="submit"
        class="w-10 h-10 flex items-center justify-center rounded-full bg-white/90 backdrop-blur shadow hover:scale-110 transition"
        aria-label="{% if cafe.id in favoritos_ids %}Quitar {{ cafe.name }} de favoritos{% else %}Agregar {{ cafe.name }} a favoritos{% endif %}"
        aria-pressed="{% if cafe.id in favoritos_ids %}true{% else %}false{% endif %}"
        title="{% if cafe.id in favoritos_ids %}Quitar {{ cafe.name }} de favoritos{% else %}Agregar {{ cafe.name }} a favoritos{% endif %}"
      >
        {% if cafe.id in favoritos_ids %}
          <span class="text-red-500 text-2xl" aria-hidden="true">❤️</span>
        {% else %}
          <span class="text-gray-400 text-2xl" aria-hidden="true">🤍</span>
        {% endif %}
      </button>
    </form>
  {% endif %}

  {# Imagen principal (altura consistente con aspect-ratio) #}
  <div class="relative aspect-[16/9] overflow-hidden">
    {% if cafe.photo1 %}
      <img
        src="{{ cafe.photo1.url }}"
        alt="Foto de {{ cafe.name|default:'café sin nombre' }}"
        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
        loading="lazy"
        decoding="async"
        width="800"
        height="450"
      >
    {% else %}
      <div class="w-full h-full bg-gray-100 flex items-center justify-center text-gray-300 text-5xl" aria-hidden="true">
        📷
      </div>
    {% endif %}
    <div class="pointer-events-none absolute inset-0 bg-gradient-to-t from-black/40 to-transparent opacity-0 group-hover:opacity-100 transition" aria-hidden="true"></div>
  </div>

  {# Contenido #}
  <div class="flex flex-col justify-between flex-grow p-5">
    <div>
      <h2
        id="cafe-{{ cafe.id }}-title"
        class="text-lg font-semibold text-gray-900 line-clamp-2"
      >
        {{ cafe.name|default:"Nombre no disponible" }}
      </h2>

      {% if cafe.location %}
        <p class="text-sm text-gray-500 mt-0.5 line-clamp-1">({{ cafe.location }})</p>
      {% endif %}

      {% if cafe.address %}
        <p class="text-sm text-gray-600 mt-1 line-clamp-1">📍 {{ cafe.address }}</p>
      {% endif %}

      <p class="text-sm font-semibold text-yellow-600 mt-2">
        ☕ {{ cafe.average_rating|default:"–"|floatformat:1 }}
      </p>
    </div>

    <div class="mt-4 flex items-center gap-2">
      <a href="{% url 'cafe_detail' cafe.id %}" class="btn btn-outline">
        Ver detalles
      </a>

      {# Botón Compartir accesible (fallback copia link al portapapeles) #}
      <button
        type="button"
        class="btn btn-ghost"
        aria-label="Compartir {{ cafe.name }}"
        title="Compartir {{ cafe.name }}"
        onclick="(async ()=>{try{
          const url='{{ request.scheme }}://{{ request.get_host }}{% url 'cafe_detail' cafe.id %}';
          if(navigator.share){ await navigator.share({ title:'{{ cafe.name|escapejs }}', url }); }
          else { await navigator.clipboard.writeText(url); alert('Link copiado'); }
        }catch(e){}})();"
      >
        ↗
      </button>
    </div>
  </div>
</div>
