{# reviews/templates/reviews/includes/_cafe_card.html #}
{% load static %}

<article class="card cafe-card focus:outline-none" tabindex="0">
  <a href="{% url 'reviews:cafe_detail' cafe.id %}" class="block">
    <div class="card-media">
      {% if cafe.photo1 and cafe.photo1.url %}
        <img src="{{ cafe.photo1.url }}"
             alt="{{ cafe.photo1_title|default:cafe.name }}"
             loading="lazy" decoding="async" fetchpriority="low">
      {% else %}
        <img src="{% static 'images/coffee-hero.jpg' %}"
             alt="Foto no disponible ‚Äî {{ cafe.name }}"
             loading="lazy" decoding="async" fetchpriority="low">
      {% endif %}
    </div>
  </a>

  <div class="card-body">
    <a href="{% url 'reviews:cafe_detail' cafe.id %}" class="block hover:underline">
      <h3 class="card-title">{{ cafe.name }}</h3>

      {% if cafe.location %}
        <p class="card-sub">{{ cafe.location }}</p>
      {% elif cafe.neighborhood %}
        <p class="card-sub">{{ cafe.neighborhood }}</p>
      {% elif cafe.address %}
        <p class="card-sub">{{ cafe.address }}</p>
      {% endif %}
    </a>

    <div class="card-actions">
      <div class="flex items-center gap-2">
        {% with avg=cafe.average_rating|default:0 %}
          <span class="badge" title="Calificaci√≥n promedio">
            ‚òï {{ avg|floatformat:1 }} / 5
          </span>
        {% endwith %}
        {% with rc=cafe.reviews_count|default:0 %}
          <span class="text-muted text-sm">({{ rc }} rese√±as)</span>
        {% endwith %}
      </div>

      <div class="flex items-center gap-2">
        {% if user.is_authenticated %}
          <button
            type="button"
            class="btn btn-outline btn-sm fav-btn {% if cafe.is_favorite %}is-fav{% endif %}"
            aria-pressed="{{ cafe.is_favorite|yesno:'true,false' }}"
            data-fav-url="{% url 'reviews:toggle_favorite' cafe.id %}">
            <span class="fav-icon" aria-hidden="true">{% if cafe.is_favorite %}‚ù§Ô∏è{% else %}ü§ç{% endif %}</span>
            <span class="sr-only">
              {% if cafe.is_favorite %}Quitar de favoritos{% else %}Agregar a favoritos{% endif %}
            </span>
          </button>

          <noscript>
            <form action="{% url 'reviews:toggle_favorite' cafe.id %}" method="post" class="inline">
              {% csrf_token %}
              <button type="submit" class="btn btn-outline btn-sm">‚ù§Ô∏è</button>
            </form>
          </noscript>
        {% endif %}

        <a href="{% url 'reviews:cafe_detail' cafe.id %}" class="btn btn-primary btn-sm">
          Ver
        </a>
      </div>
    </div>
  </div>
</article>
