{# reviews/templates/reviews/_cafe_card.html #}
<div class="recommended-card animate-fade-in-up {% cycle '' 'animate-delay-100' 'animate-delay-200' 'animate-delay-300' %} relative bg-white rounded-2xl shadow-md hover:shadow-xl transition-all duration-300 flex flex-col h-full overflow-hidden border border-gray-100 group">

  {# Botón de favoritos solo si está autenticado #}
  {% if user.is_authenticated %}
    <form method="POST" action="{% url 'toggle_favorite' cafe.id %}" class="absolute top-4 right-4 z-10">
      {% csrf_token %}
      <button type="submit"
              aria-label="{% if cafe.id in favoritos_ids %}Quitar de favoritos{% else %}Agregar a favoritos{% endif %}"
              class="favorite-btn w-10 h-10 flex items-center justify-center rounded-full bg-white shadow hover:scale-110 transition">
        {% if cafe.id in favoritos_ids %}
          <span class="text-red-500 text-2xl">❤️</span>
        {% else %}
          <span class="text-gray-400 text-2xl">🤍</span>
        {% endif %}
      </button>
    </form>
  {% endif %}

  {# Imagen principal o placeholder #}
  {% if cafe.photo1 %}
    <div class="relative">
      <img src="{{ cafe.photo1.url }}" 
           alt="Foto de {{ cafe.name|default:'café sin nombre' }}" 
           class="w-full h-56 object-cover transition-transform duration-500 group-hover:scale-105">
      <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent opacity-0 group-hover:opacity-100 transition"></div>
    </div>
  {% else %}
    <div class="w-full h-56 bg-gray-100 flex items-center justify-center text-gray-300 text-5xl" aria-hidden="true">
      📷
    </div>
  {% endif %}

  <div class="flex flex-col justify-between flex-grow p-5">
    <div>
      <h2 class="text-xl font-bold text-gray-900 flex items-center gap-1 group-hover:text-blue-600 transition-colors duration-300">
        {{ cafe.name|default:"Nombre no disponible" }}
        {% if cafe.location %}
          <span class="text-sm text-gray-500 font-normal">({{ cafe.location }})</span>
        {% endif %}
      </h2>
      {% if cafe.address %}
        <p class="text-sm text-gray-600 mt-1 mb-2">📍 {{ cafe.address }}</p>
      {% endif %}
      <p class="text-sm font-semibold text-yellow-500 flex items-center gap-1">
        ☕ {{ cafe.average_rating|default:"–"|floatformat:1 }}
      </p>
    </div>
    <a href="{% url 'cafe_detail' cafe.id %}"
       class="mt-4 inline-block px-5 py-2 bg-gradient-to-r from-blue-500 to-blue-700 text-white text-sm rounded-xl shadow hover:from-blue-600 hover:to-blue-800 hover:scale-105 transition-transform duration-300">
      Ver detalles
    </a>
  </div>
</div>
