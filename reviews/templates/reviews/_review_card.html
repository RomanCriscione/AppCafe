<article id="rev-{{ review.id }}" class="review-card p-4">
  <header class="review-head">
    <div class="review-avatar" aria-hidden="true">
      {{ review.user.username|default:"U"|slice:":1" }}
    </div>
    <div class="flex-1">
      <div class="flex items-start justify-between gap-2">
        <div class="review-meta">
          <div class="review-user">{{ review.user.username|default:"Usuario" }}</div>
          <div class="review-date">{{ review.created_at|date:"d M Y" }}</div>
        </div>
        <div class="review-rating text-sm">
          <span class="dot" aria-hidden="true"></span>
          <strong>‚òï {{ review.rating|floatformat:1 }}</strong>
        </div>
      </div>
    </div>
  </header>

  <div class="review-body mt-3 collapsed" data-collapsible>
    <div class="review-text">
      {% if review.comment %}
        <p>{{ review.comment|linebreaksbr }}</p>
      {% endif %}

      {% if review.sensory_tags.all %}
        <div class="tags-inline">
          {% for t in review.sensory_tags.all %}
            <span class="badge badge-xs">{{ t.name }}</span>
          {% endfor %}
        </div>
      {% elif review.tags.all %}
        <div class="tags-inline">
          {% for t in review.tags.all %}
            <span class="badge badge-xs">{{ t.name }}</span>
          {% endfor %}
        </div>
      {% endif %}
    </div>
    <div class="review-fade" aria-hidden="true"></div>
  </div>

  <div class="flex items-center gap-3 mt-2">
    <form method="post"
          action="{% url 'reviews:toggle_review_like' review.id %}"
          class="inline-flex items-center gap-1 like-form"
          data-review="{{ review.id }}">
      {% csrf_token %}
      <button type="submit"
              class="btn btn-sm {% if review.id in liked_ids %}btn-success{% else %}btn-outline{% endif %}"
              aria-pressed="{% if review.id in liked_ids %}true{% else %}false{% endif %}"
              aria-label="Me gusta">
        <span class="like-icon" id="like-icon-{{ review.id }}">{% if review.id in liked_ids %}‚ù§Ô∏è{% else %}ü§ç{% endif %}</span>
        <span class="ml-1" id="likes-count-{{ review.id }}">{{ review.likes_count }}</span>
      </button>
    </form>

    <button type="button" class="btn btn-outline btn-sm review-toggle" data-target="rev-{{ review.id }}" hidden>
      Ver m√°s
    </button>

    <a href="{% url 'reviews:report_review' review.id %}" class="text-xs text-red-500 hover:underline ml-auto">Denunciar</a>
  </div>
</article>
