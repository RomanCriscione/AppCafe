{% extends "base.html" %}
{% load static %}

{% block content %}
  <div class="max-w-4xl mx-auto p-4">
    <h1 class="text-2xl font-bold mb-6">Panel de dueño de cafeterías</h1>

    <div class="flex flex-col sm:flex-row gap-4 mb-6">
      <a href="{% url 'create_cafe' %}" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded text-center">
        ➕ Agregar nueva cafetería
      </a>
      <a href="{% url 'owner_reviews' %}" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded text-center">
        📋 Ver todas las reseñas
      </a>
      <a href="{% url 'planes' %}" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded text-center">
        💼 Planes para crecer
      </a>
    </div>

    {% if cafes %}
      <ul class="space-y-6">
        {% for cafe in cafes %}
          <li class="border border-gray-300 rounded-lg p-4 bg-white shadow-sm">
            <div class="flex flex-col gap-2">
              <h3 class="text-lg font-semibold">
                {{ cafe.name }} –
                {% if cafe.visibility_level == 2 %}
                  ☕☕ Plan Maestro
                {% elif cafe.visibility_level == 1 %}
                  ☕ Plan Barista
                {% else %}
                  ☕ Gratuito
                {% endif %}
              </h3>

              <p class="text-sm text-gray-600"><strong>{{ cafe.location }}</strong></p>
              <p class="text-sm text-gray-600">📍 {{ cafe.address }}</p>

              {% if cafe.photo1 %}
                <img src="{{ cafe.photo1.url }}" alt="Foto de {{ cafe.name }}" class="w-32 h-auto rounded shadow" loading="lazy">
              {% endif %}

              <p>
                {% if cafe.average_rating %}
                  ☕ {{ cafe.average_rating|floatformat:1 }}
                {% else %}
                  ☕ Sin puntuar
                {% endif %}
              </p>

              <p>🧾 Reseñas: {{ cafe.total_reviews }}</p>

              <form method="post" action="{% url 'cambiar_visibilidad' cafe.id %}" class="flex items-center gap-2 flex-wrap">
                {% csrf_token %}
                <label for="visibility_{{ cafe.id }}" class="text-sm font-medium">Cambiar plan:</label>
                <select name="visibility_level" id="visibility_{{ cafe.id }}" class="border border-gray-300 rounded px-2 py-1">
                  <option value="0" {% if cafe.visibility_level == 0 %}selected{% endif %}>☕ Gratuito – nivel base</option>
                  <option value="1" {% if cafe.visibility_level == 1 %}selected{% endif %}>☕ Plan Barista – intermedio</option>
                  <option value="2" {% if cafe.visibility_level == 2 %}selected{% endif %}>☕☕ Plan Maestro – nivel superior</option>
                </select>
                <button type="submit" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">
                  Aplicar
                </button>
              </form>

              <div class="flex gap-4 flex-wrap mt-3">
                <a href="{% url 'cafe_detail' cafe.id %}" class="text-blue-600 hover:underline font-medium">🔍 Ver detalles</a>
                <a href="{% url 'edit_cafe' cafe.id %}" class="text-yellow-600 hover:underline font-medium">✏️ Editar</a>
                <form action="{% url 'delete_cafe' cafe.id %}" method="post" class="inline">
                  {% csrf_token %}
                  <button type="submit" onclick="return confirm('¿Estás seguro de eliminar esta cafetería?')" class="text-red-600 hover:underline font-medium">
                    🗑️ Eliminar
                  </button>
                </form>
              </div>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-gray-600">No tenés cafeterías registradas todavía.</p>
    {% endif %}
  </div>
{% endblock %}