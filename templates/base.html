<!DOCTYPE html>
<html lang="es">
{% load static %}
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Preconnect -->
  <link rel="preconnect" href="https://tile.openstreetmap.org" crossorigin>
  <link rel="dns-prefetch" href="https://tile.openstreetmap.org">
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="dns-prefetch" href="https://unpkg.com">
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
  <link rel="preconnect" href="https://code.jquery.com" crossorigin>
  <link rel="dns-prefetch" href="https://code.jquery.com">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="dns-prefetch" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  {% block head_title %}<title>{{ meta_title|default:"Gota - Rese√±as de Caf√©s" }}</title>{% endblock %}
  {% block head_description %}<meta name="description" content="{{ meta_description|default:'Descubr√≠ cafeter√≠as, rese√±as reales y mapas.' }}">{% endblock %}
  {% block meta %}{% endblock %}

  <link rel="stylesheet" href="{% static 'css/animations.css' %}?v=20250811">
  <link rel="stylesheet" href="{% static 'css/tailwind.css' %}?v=20250811">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="{% static 'css/custom.css' %}?v=20250814">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

  <link rel="icon" href="{% static 'img/favicon.ico' %}">
  <link rel="apple-touch-icon" href="{% static 'img/icon-192.png' %}">
  <link rel="manifest" href="{% static 'site.webmanifest' %}">
  <meta name="theme-color" content="#111827">
  <link rel="canonical" href="{{ request.build_absolute_uri }}"/>

  <meta property="og:title" content="{{ page_title|default:'Gota ‚Äî Descubr√≠ tu pr√≥ximo caf√©' }}">
  <meta property="og:description" content="{{ page_description|default:'Encontr√° caf√©s por zona, estilo y experiencia.' }}">
  {% if og_image_url %}
    <meta property="og:image" content="{{ og_image_url }}">
  {% else %}
    <meta property="og:image" content="{% static 'img/og-default.jpg' %}">
  {% endif %}
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ request.build_absolute_uri }}">
  <meta name="twitter:card" content="summary_large_image">

  <style>
    html, body { overflow-x: hidden; }
    body { font-family: 'Poppins', sans-serif; }

    /* Header SIEMPRE arriba y con fondo blanco s√≥lido */
    header.site-nav {
      position: fixed; top: 0; left: 0; right: 0;
      z-index: 2147483647 !important;
      background: #ffffff !important;
      -webkit-backdrop-filter: none !important;
      backdrop-filter: none !important;
    }

    /* Leaflet por debajo del header */
    .leaflet-container,
    .leaflet-pane,
    .leaflet-map-pane,
    .leaflet-tile-pane,
    .leaflet-overlay-pane,
    .leaflet-marker-pane,
    .leaflet-shadow-pane,
    .leaflet-tooltip-pane,
    .leaflet-popup-pane,
    .leaflet-top,
    .leaflet-bottom,
    .leaflet-control { z-index: 0 !important; }

    /* Panel/overlay de filtros debajo del header pero sobre contenido */
    #panel-filtros { z-index: 2000 !important; }
    #filtros-overlay { z-index: 1900 !important; }
    #toggle-filtros { z-index: 1800 !important; }

    /* ========= ‚úÖ CTA OVERRIDES (cargado al final) ========= */
    :root { --cta-w: 280px; }

    /* Se usa junto con id="owner-actions" en owner_dashboard.html */
    #owner-actions a.cta{
      display:inline-flex !important;
      align-items:center !important;
      justify-content:center !important;
      gap:.5rem !important;
      width: var(--cta-w) !important;   /* mismo ancho */
      height:48px !important;           /* mismo alto  */
      padding:0 1.25rem !important;
      border-radius:12px !important;
      font-weight:700 !important;
      letter-spacing:.01em;
      line-height:1 !important;
      color:#fff !important;
      border:1px solid transparent !important;
      background-color:#2563eb !important; /* fallback azul */
      box-shadow: 0 10px 25px rgba(2,8,23,.06) !important;
      transition: transform .15s ease, box-shadow .15s ease, background-color .15s ease;
      white-space:nowrap;
      text-align:center;
    }
    #owner-actions a.cta:hover{
      transform: translateY(-1px);
      box-shadow: 0 16px 36px rgba(2,8,23,.12) !important;
      filter: saturate(1.05);
    }
    #owner-actions a.cta:active{ transform: translateY(0); }
    #owner-actions a.cta:focus-visible{ outline:2px solid #1e40af; outline-offset:2px; }

    /* Variantes de color */
    #owner-actions a.cta.cta-blue   { background-color:#2563eb !important; }
    #owner-actions a.cta.cta-blue:hover   { background-color:#1d4ed8 !important; }

    #owner-actions a.cta.cta-green  { background-color:#16a34a !important; }
    #owner-actions a.cta.cta-green:hover  { background-color:#15803d !important; }

    #owner-actions a.cta.cta-indigo { background-color:#4f46e5 !important; }
    #owner-actions a.cta.cta-indigo:hover { background-color:#4338ca !important; }

    #owner-actions a.cta.cta-orange { background-color:#f97316 !important; }
    #owner-actions a.cta.cta-orange:hover { background-color:#ea580c !important; }

    @media (max-width: 639px){
      #owner-actions a.cta{ width:100% !important; }
    }
    /* ========= /CTA OVERRIDES ========= */
  </style>
</head>

<body class="bg-light text-dark">
  <div class="min-h-screen flex flex-col">

    <!-- Navbar -->
    <header class="site-nav shadow">
      <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
        <!-- Logo + enlaces -->
        <div class="flex items-center gap-8">
          <a href="{% url 'home' %}" class="text-2xl font-bold text-primary">Gota</a>

          <!-- Toggle mobile -->
          <button id="menu-toggle" class="lg:hidden text-gray-700" aria-label="Abrir men√∫">
            <i class="fas fa-bars text-xl" aria-hidden="true"></i>
          </button>

          <nav id="navbar-menu" class="hidden lg:flex lg:items-center lg:gap-6">
            <a href="{% url 'home' %}" class="block py-2 lg:py-0 text-gray-700 hover:text-primary">Inicio</a>
            <a href="{% url 'cafe_list' %}" class="block py-2 lg:py-0 text-gray-700 hover:text-primary">Caf√©s</a>
            <a href="{% url 'mapa_cafes' %}" class="block py-2 lg:py-0 text-gray-700 hover:text-primary">üìç Mapa</a>
            <a href="{% url 'about' %}" class="block py-2 lg:py-0 text-gray-700 hover:text-primary">Acerca de</a>
            <a href="{% url 'contact' %}" class="block py-2 lg:py-0 text-gray-700 hover:text-primary">Contacto</a>
            {% if user.is_authenticated %}
              <a href="{% url 'favorite_cafes' %}" class="block py-2 lg:py-0 text-gray-700 hover:text-primary">‚ù§Ô∏è Favoritos</a>
            {% endif %}
          </nav>
        </div>

        <!-- Botones de usuario -->
        <div class="flex items-center gap-3">
          {% if user.is_authenticated %}
            <span class="font-semibold text-gray-800">Hola, {{ user.username }}</span>
            {% if user.avatar %}
              <img src="{{ user.avatar.url }}" alt="Avatar de {{ user.username }}" class="w-8 h-8 rounded-full border object-cover" />
            {% endif %}

            {% if user.is_owner %}
              <a href="{% url 'create_cafe' %}" class="hover:underline">‚ûï Agregar Caf√©</a>
              <a href="{% url 'owner_dashboard' %}" class="hover:underline">Mis Caf√©s</a>
            {% else %}
              <a href="{% url 'register_owner' %}"
                 class="bg-green-500 hover:bg-green-600 text-white px-3 py-1.5 rounded-md font-medium transition flex items-center gap-2">
                <i class="fas fa-coffee text-sm" aria-hidden="true"></i> Registrar tu caf√©
              </a>
            {% endif %}

            <a href="{% url 'account_logout' %}" class="text-red-500 hover:underline text-sm">Cerrar sesi√≥n</a>
          {% else %}
            <a href="{% url 'account_login' %}" class="text-primary hover:underline">Iniciar sesi√≥n</a>
            <a href="{% url 'account_signup' %}"
               class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-md font-medium transition">
              Registrarse
            </a>
            <a href="{% url 'register_owner' %}"
               class="bg-green-500 hover:bg-green-600 text-white px-3 py-1.5 rounded-md font-medium transition flex items-center gap-2">
              <i class="fas fa-coffee text-sm" aria-hidden="true"></i> Registrar tu caf√©
            </a>
          {% endif %}
        </div>
      </div>
    </header>

    <!-- JS toggle navbar -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const toggle = document.getElementById("menu-toggle");
        const menu = document.getElementById("navbar-menu");
        if (toggle && menu) toggle.addEventListener("click", () => menu.classList.toggle("hidden"));
      });
    </script>

    <!-- Contenido principal -->
    <main class="flex-1 container mx-auto px-4 py-6 pt-24 relative z-0">
      {% if messages %}
        <div class="fixed top-4 right-4 z-[2147483000] space-y-2">
          {% for message in messages %}
            <div class="px-4 py-2 rounded shadow text-white alert-message
                        {% if message.tags == 'success' %} bg-green-500
                        {% elif message.tags == 'error' %} bg-red-500
                        {% else %} bg-blue-500 {% endif %}">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}

      {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t py-4 text-center text-sm text-gray-500">
      ¬© 2025 Gota ‚Äì Una app de Roma ‚òï
    </footer>
  </div>

  <!-- JS externos (defer) -->
  <script defer src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script defer src="{% static 'js/main.js' %}"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      if (document.querySelector('.swiper-container')) {
        new Swiper('.swiper-container', {
          slidesPerView: 'auto',
          spaceBetween: 16,
          navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
          pagination: { el: '.swiper-pagination', clickable: true },
        });
      }
      document.querySelectorAll('.alert-message').forEach(alert => {
        setTimeout(() => {
          alert.classList.add('opacity-0', 'transition-opacity', 'duration-500');
          setTimeout(() => alert.remove(), 500);
        }, 2000);
      });
    });
  </script>

  {% block scripts %}{% endblock %}
</body>
</html>
